version: 2

models:
  - name: int_hourly_weather_flagged
    description: "A table which contains hourly weather information with category flags"
    columns:
      - name: timestamp_utc
        description: "Timestamp of the weather information in UTC"
        data_type: timestamp
        tests:
          - not_null
          - unique

      - name: timestamp_cet
        description: "Timestamp of the weather information in CET/CEST."
        data_type: timestamp
        tests:
          - not_null

      - name: temperature_2m
        description: "Air temperature at 2m above the surface of land, sea or inland waters (Â°C)"
        data_type: float

      - name: precipitation
        description: "Precipitation in millimeters"
        data_type: float  

      - name: precipitation_probability
        description: "Probability of precipitation."
        data_type: float

      - name: visibility
        description: "Viewing distance in meters, influenced by low clouds, humidity and aerosols"
        data_type: float

      - name: windspeed_10m
        description: "Wind speed at 10 meters above ground (km/h)"
        data_type: float

      - name: general_weather_condition
        description: "Categorical weather label derived from temperature, precipitation, and visibility (clear, cloudy, rain, snow, fog)."
        data_type: string

      - name: temperature_category
        description: "Temperature classification bucket (cold, mild, warm, hot)."
        data_type: string

      - name: precipitation_category
        description: "Precipitation intensity bucket (none, light, moderate, heavy)."
        data_type: string

      - name: precipitation_probability_category
        description: "Precipitation probability level (low, medium, high)."
        data_type: string

      - name: wind_category
        description: "Wind speed classification (calm, breezy, windy, storm)."
        data_type: string

      - name: visibility_category
        description: "Visibility condition (poor, moderate, good)."
        data_type: string

      - name: anormality_category
        description: "Flag describing anomaly level for weather variables (none, anormal, very anormal)."
        data_type: string

    tests:
      - dbt_utils.expression_is_true:
          arguments:
            expression: "timestamp_utc < timestamp_cet"

