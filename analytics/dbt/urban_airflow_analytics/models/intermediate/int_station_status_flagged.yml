version: 2

models:
  - name: int_station_status_flagged
    description: "Intermediate station status model with status flag"
    columns:
      - name: station_id
        description: "Id of the Vélib station"
        data_type: string
        tests:
          - not_null

      - name: last_reported_utc
        description: "Timestamp of the last reported time in UTC"
        data_type: timestamp

      - name: last_reported_cet
        description: "Timestamp of the last reported time in CET/CEST"
        data_type: timestamp

      - name: is_installed
        description: "True if the station is operational, false if being developed"
        data_type: boolean

      - name: is_renting
        description: "True if the station is capable to rent bikes, false otherwise"
        data_type: boolean

      - name: is_returning
        description: "True if the station is capable to receive a return, false otherwise"
        data_type: boolean

      - name: num_bikes_available
        description: "Number of bikes available at the time of the report"
        data_type: integer

      - name: num_docks_available
        description: "Number of bike docks available (empty) at the time of the report"
        data_type: integer

      - name: station_capacity
        description: "Capacity of the station"
        data_type: integer

      - name: is_full
        description: "True when all docks are occupied — no bikes can be returned."
        data_type: boolean
        tests:
          - not_null

      - name: is_empty
        description: "True when all docks are available — no bikes can be rented."
        data_type: boolean
        tests:
          - not_null

      - name: num_bikes_in_maintenance
        description: "Estimated bikes unavailable or under maintenance, calculated as capacity - (bikes + docks)."
        data_type: integer

    tests:
      - dbt_utils.expression_is_true:
          arguments:
            expression: "last_reported_utc < last_reported_cet" 
            severity: warn

      - dbt_utils.expression_is_true:
          arguments:
            expression: "num_bikes_available <= station_capacity" 
            severity: warn

      - dbt_utils.expression_is_true:
          arguments:
            expression: "num_docks_available <= station_capacity" 
            severity: warn

      - dbt_utils.expression_is_true:
          arguments:
            expression: "num_bikes_in_maintenance >= 0" 
            severity: warn