version: 2

models:
  - name: fct_transport_disruption
    description: "A table which contains Paris public transport disruptions with flags."
    columns:
      - name: event_id
        description: "ID of the disruption event"
        data_type: string
        tests:
          - not_null
          - unique

      - name: started_at_cet
        description: "Timestamp of the start of the disruption event in CET/CEST"
        data_type: timestamp

      - name: ended_at_cet
        description: "Timestamp of the end of the disruption event in CET/CEST"
        data_type: timestamp

      - name: disruption_cause_fr
        description: "Reason for disruption in French (Travaux, Perturbation, Information)"
        data_type: string

      - name: disruption_severity_fr
        description: "Severity of disruption in French (Bloquante, Perturb√©e, Information)"
        data_type: string

      - name: message_title_fr
        description: "Title of the message, usually a summary of the affected line and reason"
        data_type: string

      - name: message_body_fr
        description: "Content of the message, details of the disruption"
        data_type: string

      - name: disruption_duration
        description: "Total duration of the disruption as an interval between start and end times."
        data_type: interval

      - name: duration_category
        description: |
          Duration classification based on total active time:
            - **short**: less than 1 hour  
            - **medium**: between 1 hour and 23h59  
            - **long**: between 1 day and 7 days  
            - **extended**: between 7 days and 30 days  
            - **persistent**: more than 30 days
        data_type: string
        tests:
          - accepted_values:
              values: ['short', 'medium', 'long', 'extended', 'persistent']

      - name: is_active
        description: "Boolean flag indicating whether the disruption is currently ongoing."
        data_type: boolean
        tests:
          - not_null

      - name: is_planned
        description: "Boolean flag indicating whether the disruption is scheduled to start in the future."
        data_type: boolean
        tests:
          - not_null

    tests:
      - dbt_utils.expression_is_true:
          arguments:
            expression: "started_at_cet < ended_at_cet" 