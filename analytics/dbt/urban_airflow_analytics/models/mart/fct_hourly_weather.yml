version: 2

models:
  - name: fct_hourly_weather
    description: "A table which contains hourly weather information."
    columns:
      - name: timestamp_cet
        description: "Timestamp of the weather information in CET/CEST."
        data_type: timestamp
        tests:
          - not_null

      - name: date_cet
        description: "Date of the reported time in CET/CEST"
        data_type: date

      - name: hour_cet
        description: "Hour of the reported time in CET/CEST (0-23)"
        data_type: integer
        tests:
          - dbt_utils.accepted_range:
              arguments:
                min_value: 0
                max_value: 23        

      - name: temperature_2m
        description: "Air temperature at 2m above the surface of land, sea or inland waters (°C)"
        data_type: float

      - name: precipitation
        description: "Precipitation in millimeters"
        data_type: float  

      - name: precipitation_probability
        description: "Probability of precipitation."
        data_type: float
        tests:
          - dbt_utils.accepted_range:
              arguments:
                min_value: 0
                max_value: 1

      - name: visibility
        description: "Viewing distance in meters, influenced by low clouds, humidity and aerosols"
        data_type: float

      - name: windspeed_10m
        description: "Wind speed at 10 meters above ground (km/h)"
        data_type: float

      - name: general_weather_condition
        description: |
          General weather condition derived from precipitation, temperature, and visibility:
            - **snow**: precipitation > 0.1 mm and temperature ≤ 1 °C  
            - **rain**: precipitation > 0.1 mm and temperature > 1 °C  
            - **fog**: visibility < 1000 m  
            - **clear**: precipitation = 0 mm and visibility ≥ 10000 m  
            - **cloudy**: all other cases
        data_type: string
        tests:
          - accepted_values:
              values: ['clear', 'cloudy', 'rain', 'snow', 'fog']

      - name: temperature_category
        description: |
          Temperature classification:
            - **cold**: < 0 °C  
            - **mild**: 0 – 14 °C  
            - **warm**: 15 – 24 °C  
            - **hot**: ≥ 25 °C
        data_type: string
        tests:
          - accepted_values:
              values: ['cold', 'mild', 'warm', 'hot']

      - name: precipitation_category
        description: |
          Precipitation intensity:
            - **none**: 0 mm  
            - **light**: 0 – 1.9 mm  
            - **moderate**: 2 – 9.9 mm  
            - **heavy**: ≥ 10 mm
        data_type: string
        tests:
          - accepted_values:
              values: ['none', 'light', 'moderate', 'heavy']

      - name: precipitation_probability_category
        description: |
          Precipitation probability:
            - **low**: < 20 %  
            - **medium**: 20 – 59 %  
            - **high**: ≥ 60 %
        data_type: string
        tests:
          - accepted_values:
              values: ['low', 'medium', 'high']

      - name: wind_category
        description: |
          Wind speed classification:
            - **calm**: < 2 m/s  
            - **breezy**: 2 – 7.9 m/s  
            - **windy**: 8 – 16.9 m/s  
            - **storm**: ≥ 17 m/s
        data_type: string
        tests:
          - accepted_values:
              values: ['calm', 'breezy', 'windy', 'storm']

      - name: visibility_category
        description: |
          Visibility range:
            - **poor**: < 1000 m  
            - **moderate**: 1000 – 9999 m  
            - **good**: ≥ 10000 m
        data_type: string
        tests:
          - accepted_values:
              values: ['poor', 'moderate', 'good']

      - name: anormality_category
        description: |
          Anomaly level based on extreme or invalid sensor values:
            - **none**: all variables within normal ranges  
            - **anormal**: temperature < –30 °C or > 45 °C, precipitation > 20 mm, windspeed > 25 m/s, or visibility < 100 m / > 100000 m  
            - **very anormal**: temperature < –40 °C or > 50 °C, precipitation > 50 mm, windspeed > 40 m/s, or visibility < 0 m / > 150000 m
        data_type: string
        tests:
          - accepted_values:
              values: ['none', 'anormal', 'very anormal']